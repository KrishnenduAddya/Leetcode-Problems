// Flipkart Paytm PhonePe

// Binary Search on 2D Matrix

public class Solution {
    public int KthSmallest(int[][] matrix, int k) {
        int n = matrix.Length;
        
        // The search space is between the smallest and largest elements in the matrix
        int left = matrix[0][0];              // Smallest element
        int right = matrix[n - 1][n - 1];     // Largest element

        while (left < right)
        {
            int mid = left + (right - left) / 2;

            // Count how many elements are <= mid
            int count = CountLessEqual(matrix, mid, n);

            // If count is less than k, kth element must be larger â†’ move right
            if (count < k)
                left = mid + 1;
            else
                right = mid;
        }

        return left;
    }

    private int CountLessEqual(int[][] matrix, int mid, int n) {
        int count = 0;

        // Start from bottom left corner
        int row = n - 1;
        int col = 0;

        // Traverse matrix intelligently:
        // If current element <= mid, all elements above in that column are also <= mid
        // Otherwise, move up one row
        while (row >= 0 && col < n)
        {
            if (matrix[row][col] <= mid)
            {
                // Add all elements in this column up to current row
                count += row + 1;
                col++;
            }
            else
                row--;
        }

        return count;
    }
}
